"use strict";(self["webpackChunkbylw"]=self["webpackChunkbylw"]||[]).push([[879],{9879:function(e,t,l){l.r(t),l.d(t,{default:function(){return c}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"Bill"},[t("el-button",{staticStyle:{margin:"0 15px 15px 0"},attrs:{type:"primary"},on:{click:e.handleAdd}},[e._v("新增账单 "),t("i",{staticClass:"el-icon-circle-plus-outline",staticStyle:{"font-size":"14px"}})]),t("el-tag",{attrs:{type:"warning"}},[e._v("请确认账单后在仓库管理更新物品")]),t("el-dialog",{attrs:{title:"新增账单信息",visible:e.dialogFormVisible,width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t},close:e.closeDialog}},[t("el-form",{attrs:{model:e.form,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"采购人"}},[t("el-input",{model:{value:e.form.nickname,callback:function(t){e.$set(e.form,"nickname",t)},expression:"form.nickname"}})],1),t("el-form-item",{attrs:{label:"电话"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.phone,callback:function(t){e.$set(e.form,"phone",t)},expression:"form.phone"}})],1),t("el-form-item",{attrs:{label:"名称"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),t("el-form-item",{attrs:{label:"数量"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.count,callback:function(t){e.$set(e.form,"count",t)},expression:"form.count"}})],1),t("el-form-item",{attrs:{label:"单价"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.price,callback:function(t){e.$set(e.form,"price",t)},expression:"form.price"}})],1),t("el-form-item",{attrs:{label:"采购凭证"}},[t("el-upload",{ref:"upload",staticClass:"picture-uploader",attrs:{"list-type":"picture",action:"http://localhost:90/file/upload","before-upload":e.beforeUpload,"on-exceed":e.handleExceed,limit:1,"on-success":e.handleSuccess}},[t("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[t("i",{staticClass:"el-icon-plus"}),e._v("选择上传")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v("只能上传jpg/png文件,且不超过1MB")])],1)],1),t("el-form-item",{attrs:{label:"备注"}},[t("el-input",{attrs:{autocomplete:"off"},model:{value:e.form.note,callback:function(t){e.$set(e.form,"note",t)},expression:"form.note"}})],1)],1),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.save}},[e._v("确 定")])],1)],1),t("el-table",{staticStyle:{width:"100%","margin-bottom":"15px"},attrs:{data:e.tableData,stripe:"",border:""}},[t("el-table-column",{attrs:{prop:"id",label:"id",width:"60"}}),t("el-table-column",{attrs:{prop:"nickname",label:"采购人",width:"100"}}),t("el-table-column",{attrs:{prop:"phone",label:"电话",width:"120"}}),t("el-table-column",{attrs:{prop:"name",label:"名称",width:"100"}}),t("el-table-column",{attrs:{prop:"count",label:"数量",width:"70"}}),t("el-table-column",{attrs:{prop:"price",label:"单价",width:"70"}}),t("el-table-column",{attrs:{prop:"picture",label:"采购凭证",width:"210"},scopedSlots:e._u([{key:"default",fn:function(l){return[t("el-popover",{attrs:{placement:"right",title:"",trigger:"click"}},[l.row.picture?t("el-image",{staticStyle:{"max-height":"200px","max-width":"200px"},attrs:{slot:"reference",src:l.row.picture,alt:l.row.picture},slot:"reference"}):e._e(),t("el-image",{attrs:{src:l.row.picture}})],1)]}}])}),t("el-table-column",{attrs:{prop:"time",label:"确认时间",width:"110"}}),t("el-table-column",{attrs:{prop:"note",label:"备注",width:"150"}}),t("el-table-column",{attrs:{prop:"state",label:"处理状态",width:"100"},scopedSlots:e._u([{key:"default",fn:function(l){return["未确认"==l.row.state?t("span",{staticClass:"text",staticStyle:{backgroundColor:"#909399"}},[e._v(e._s(l.row.state))]):t("span",{staticClass:"text",staticStyle:{backgroundColor:"#67C23A"}},[e._v(e._s(l.row.state))])]}}])}),t("el-table-column",{attrs:{label:"操作",width:"190"},scopedSlots:e._u([{key:"default",fn:function(l){return"admin"===e.user.username?[t("el-popconfirm",{staticStyle:{"margin-left":"5px"},attrs:{"confirm-button-text":"确认","cancel-button-text":"我再想想",icon:"el-icon-info","icon-color":"red",title:"是否确认账单？"},on:{confirm:function(t){return e.handleBill(l.row.id)}}},["未确认"==l.row.state?t("el-button",{attrs:{slot:"reference",size:"mini",type:"info"},slot:"reference"},[e._v("确认 "),t("i",{staticClass:"el-icon-remove-outline"})]):e._e()],1),t("el-popconfirm",{staticStyle:{"margin-left":"5px"},attrs:{"confirm-button-text":"确认","cancel-button-text":"再想想",icon:"el-icon-info","icon-color":"red",title:"您确定删除吗？"},on:{confirm:function(t){return e.handleDelete(l.row.id)}}},[t("el-button",{attrs:{slot:"reference",size:"mini",type:"danger"},slot:"reference"},[e._v("删除 "),t("i",{staticClass:"el-icon-remove-outline"})])],1)]:void 0}}],null,!0)})],1),t("el-pagination",{attrs:{"current-page":e.pageNum,"page-sizes":[5,10,15,20],"page-size":e.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.total},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)},o=[],i={name:"Bill",data(){return{tableData:[],pageNum:1,pageSize:5,total:0,user:JSON.parse(sessionStorage.getItem("user"))||"",staff:"",form:{name:"",nickname:"",phone:"",count:"",price:"",total:"",picture:"",note:""},dialogFormVisible:!1,fileList:[]}},created(){this.load()},methods:{handleSizeChange(e){this.pageSize=e,this.loadTwo()},handleCurrentChange(e){this.pageNum=e,this.loadTwo()},async load(){if("admin"!==this.user.level){const e=await this.getStaffPhone();this.staff=e.data}this.loadTwo()},loadTwo(){this.request.get("/api/bill/page",{params:{pageNum:this.pageNum,pageSize:this.pageSize,phone:"admin"===this.user.level?"":this.staff.phone}}).then((e=>{"200"===e.code&&(this.tableData=e.data.records,this.total=e.data.total)}))},getStaffPhone(){return this.request.get("/api/staff/pid/"+this.user.id)},handleBill(e){this.request.post("/api/bill",{id:e,state:"已确认",time:this.tool.getNowDate()}).then((e=>{"200"===e.code&&this.load()}))},handleDelete(e){this.request.delete("/api/bill/"+e).then((e=>{"200"===e.code?(this.$message.success("删除成功"),this.load()):this.$message.error("删除失败")}))},handleAdd(){this.form={},this.form.nickname=this.user.nickname,this.form.phone=this.staff.phone||"",this.dialogFormVisible=!0},save(){this.form.total=this.form.count*this.form.price,console.log(this.form.total),this.request.post("/api/bill",this.form).then((e=>{"200"===e.code?(this.$message.success("新增/编辑成功"),this.dialogFormVisible=!1,this.load()):this.$message.error("新增/编辑失败")}))},beforeUpload(e){let t=["image/jpeg","image/jpg","image/gif","image/bmp","image/png"];const l=t.includes(e.type),a=e.size/1024/1024<1;return l?!!a||(this.$message.error("上传图片大小不能超过 1MB!"),!1):(this.$message.error("上传图片只能是 JPG、JPEG、gif、bmp、PNG 格式!"),!1)},handleExceed(){this.$message.error("最多支持1个附件上传")},handleSuccess(e){this.$message.success("上传成功"),this.form.picture=e},closeDialog(){this.$refs.upload.clearFiles()}}},s=i,r=l(1001),n=(0,r.Z)(s,a,o,!1,null,"db765bea",null),c=n.exports}}]);
//# sourceMappingURL=879.6ce58893.js.map
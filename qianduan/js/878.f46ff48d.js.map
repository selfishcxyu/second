{"version":3,"file":"js/878.f46ff48d.js","mappings":"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","sources":["webpack://bylw/./src/views/Complaint/Suggestion.vue","webpack://bylw/src/views/Complaint/Suggestion.vue","webpack://bylw/./src/views/Complaint/Suggestion.vue?bdee","webpack://bylw/./src/views/Complaint/Suggestion.vue?3965"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"suggestion\"},[_c('h2',[_vm._v(\"住户建议留言表\")]),_c('el-card',{staticClass:\"input\"},[_c('el-input',{attrs:{\"type\":\"textarea\",\"rows\":2,\"placeholder\":\"请输入内容\"},model:{value:(_vm.suggestion),callback:function ($$v) {_vm.suggestion=$$v},expression:\"suggestion\"}}),_c('el-button',{staticClass:\"send\",attrs:{\"type\":\"primary\"},on:{\"click\":_vm.sendSuggestion}},[_vm._v(\"发送留言\")])],1),_c('div',{staticStyle:{\"margin-bottom\":\"10px\"}},[_c('el-radio-group',{model:{value:(_vm.reverse),callback:function ($$v) {_vm.reverse=$$v},expression:\"reverse\"}},[_c('el-radio',{attrs:{\"label\":true}},[_vm._v(\"倒序\")]),_c('el-radio',{attrs:{\"label\":false}},[_vm._v(\"正序\")])],1)],1),_c('el-timeline',{directives:[{name:\"infinite-scroll\",rawName:\"v-infinite-scroll\",value:(_vm.load),expression:\"load\"}],attrs:{\"infinite-scroll-disabled\":\"disabled\",\"infinite-scroll-distance\":\"10\",\"infinite-scroll-delay\":\"1000\",\"reverse\":_vm.reverse}},[_vm._l((_vm.msgData),function(msg){return _c('el-timeline-item',{key:msg.id,attrs:{\"timestamp\":msg.time,\"placement\":\"top\"}},[_c('el-card',{attrs:{\"body-style\":\"display: flex; position: relative;\"}},[_c('img',{staticStyle:{\"width\":\"50px\",\"border-radius\":\"25px\",\"margin-right\":\"25px\"},attrs:{\"src\":msg.avatar}}),_c('div',[_c('h4',{staticStyle:{\"margin-bottom\":\"10px\"}},[_vm._v(_vm._s(msg.username))]),_c('p',[_vm._v(_vm._s(msg.suggestion))])]),_c('el-popconfirm',{staticStyle:{\"margin-left\":\"5px\",\"position\":\"absolute\",\"right\":\"20px\",\"top\":\"15px\"},attrs:{\"confirm-button-text\":\"确认\",\"cancel-button-text\":\"再想想\",\"icon\":\"el-icon-info\",\"icon-color\":\"red\",\"title\":\"您确定删除吗？\"},on:{\"confirm\":function($event){return _vm.handleDelete(msg.id)}}},[(msg.username == _vm.user.username || _vm.user.username =='admin')?_c('el-button',{attrs:{\"slot\":\"reference\",\"type\":\"danger\",\"size\":\"small\"},slot:\"reference\"},[_vm._v(\"删除留言\")]):_vm._e()],1)],1)],1)}),(_vm.loading)?_c('p',{staticClass:\"loading\",staticStyle:{\"margin-top\":\"10px\"}},[_c('span')]):_vm._e(),(_vm.noMore)?_c('p',{staticStyle:{\"margin-top\":\"10px\",\"font-size\":\"13px\",\"color\":\"#ccc\"}},[_vm._v(\"没有更多了...\")]):_vm._e()],2),_c('el-backtop',{attrs:{\"target\":\".suggestion\"}},[_c('i',{staticClass:\"el-icon-caret-top\"})])],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"suggestion\">\r\n    <h2>住户建议留言表</h2>\r\n    <el-card class=\"input\">\r\n      <el-input type=\"textarea\" :rows=\"2\" placeholder=\"请输入内容\" v-model=\"suggestion\"></el-input>\r\n      <el-button type=\"primary\" @click=\"sendSuggestion\" class=\"send\">发送留言</el-button>\r\n    </el-card>\r\n\r\n    <div style=\"margin-bottom: 10px;\">\r\n      <el-radio-group v-model=\"reverse\">\r\n        <el-radio :label=\"true\">倒序</el-radio>\r\n        <el-radio :label=\"false\">正序</el-radio>\r\n      </el-radio-group>\r\n    </div>\r\n\r\n    <el-timeline v-infinite-scroll=\"load\" infinite-scroll-disabled=\"disabled\" infinite-scroll-distance=\"10\" infinite-scroll-delay=\"1000\" :reverse=\"reverse\">\r\n      <el-timeline-item \r\n        v-for=\"msg in msgData\"\r\n        :key=\"msg.id\"\r\n        :timestamp=\"msg.time\"\r\n        placement=\"top\">\r\n        <el-card body-style=\"display: flex; position: relative;\">\r\n          <img :src=\"msg.avatar\" style=\"width:50px;border-radius:25px;margin-right:25px;\">\r\n          <div>\r\n            <h4 style=\"margin-bottom:10px;\">{{msg.username}}</h4>\r\n            <p>{{msg.suggestion}}</p>\r\n          </div>\r\n          <el-popconfirm\r\n            style=\"margin-left: 5px;position: absolute; right: 20px; top :15px;\"\r\n            confirm-button-text='确认'\r\n            cancel-button-text='再想想'\r\n            icon=\"el-icon-info\"\r\n            icon-color=\"red\"\r\n            title=\"您确定删除吗？\"\r\n            @confirm=\"handleDelete(msg.id)\"\r\n          >\r\n            <el-button slot=\"reference\" type=\"danger\" size=\"small\" v-if=\"msg.username == user.username || user.username =='admin'\">删除留言</el-button>\r\n          </el-popconfirm>\r\n        </el-card>\r\n      </el-timeline-item>\r\n      <p v-if=\"loading\" style=\"margin-top:10px;\" class=\"loading\">\r\n        <span></span>\r\n      </p>\r\n      <p v-if=\"noMore\" style=\"margin-top:10px;font-size:13px;color:#ccc\">没有更多了...</p>\r\n    </el-timeline>\r\n\r\n    <el-backtop target=\".suggestion\"><i class=\"el-icon-caret-top\"></i></el-backtop>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nexport default {\r\n    name:'Suggestion',\r\n    data() {\r\n      return {\r\n        msgData:[],\r\n        pageNum:0,\r\n        pageSize:5, //每次获取5条留言，下拉刷新(使pageNum+1）后再获取5条，添加到msgData中\r\n        total:0,\r\n        loading:false, //控制加载是否显示\r\n        user: JSON.parse(sessionStorage.getItem(\"user\")) || '',\r\n        suggestion:'',\r\n        reverse: false,\r\n      }\r\n    },\r\n    created() {\r\n      this.load()\r\n    },\r\n    computed: {\r\n      noMore(){  //获取的数据的长度比总数大时就为true\r\n        return this.msgData.length >= this.total \r\n      },\r\n      disabled(){\r\n        return this.loading || this.noMore;\r\n      }\r\n    },\r\n    methods: {\r\n      //载入建议\r\n      load(){\r\n        this.loading = true\r\n        this.pageNum += 1\r\n        console.log(this.pageNum);\r\n        this.request.get('/api/suggestion/page',{params:{pageNum:this.pageNum,pageSize:this.pageSize}}).then((value) => {\r\n          if(value.code === '200'){\r\n            this.msgData = this.msgData.concat(value.data.records)\r\n            this.total=value.data.total\r\n            this.loading = false\r\n          }\r\n        })\r\n      },\r\n      //删除自己的建议\r\n      handleDelete(id) {\r\n        this.request.delete('/api/suggestion/'+id).then(res=>{\r\n          console.log(res);\r\n          if(res.code === '200'){\r\n            this.$message.success(\"删除成功\")\r\n            location.reload()\r\n          }else{\r\n            this.$message.error(\"删除失败\")\r\n          }\r\n        })  \r\n      },\r\n      //新增建议\r\n      sendSuggestion(){\r\n        const time = this.tool.getNowDate()\r\n        this.request.post('/api/suggestion',{\r\n          username:this.user.username,\r\n          avatar:this.user.avatar,\r\n          time:time,\r\n          suggestion:this.suggestion,\r\n        }).then(res => {\r\n          if(res.code === '200'){\r\n            this.$message.success(\"新增成功\")\r\n            this.request.get('/api/suggestion/new').then(value => {\r\n              console.log(value);\r\n              if(value.code === '200'){\r\n                this.msgData.unshift(value.data)\r\n                this.total += 1\r\n              }\r\n            })\r\n            this.suggestion = ''\r\n          }else{\r\n            this.$message.error(\"新增失败\")\r\n          }\r\n        })   \r\n      }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n.suggestion{\r\n  height: 100vh;\r\n  overflow-y: auto;\r\n  .input{\r\n    height: 128px;\r\n    margin:20px auto;\r\n    position: relative;\r\n    .send{\r\n      margin-top: 10px;\r\n      position: absolute;\r\n      right: 20px;\r\n      bottom: 10px;\r\n    }\r\n  }\r\n  .loading span {\r\n    display: inline-block;\r\n    width: 20px;\r\n    height: 20px;\r\n    border: 2px solid #409eff;\r\n    border-left: transparent;\r\n    animation: zhuan 0.5s linear infinite;\r\n    border-radius: 50%;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Suggestion.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./Suggestion.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Suggestion.vue?vue&type=template&id=2ece12e5&scoped=true&\"\nimport script from \"./Suggestion.vue?vue&type=script&lang=js&\"\nexport * from \"./Suggestion.vue?vue&type=script&lang=js&\"\nimport style0 from \"./Suggestion.vue?vue&type=style&index=0&id=2ece12e5&prod&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"2ece12e5\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","_v","attrs","model","value","suggestion","callback","$$v","expression","on","sendSuggestion","staticStyle","reverse","directives","name","rawName","load","_l","msgData","msg","key","id","time","avatar","_s","username","$event","handleDelete","user","slot","_e","loading","noMore","staticRenderFns","data","pageNum","pageSize","total","created","computed","disabled","methods","console","params","location","component"],"sourceRoot":""}
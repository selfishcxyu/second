"use strict";(self["webpackChunkbylw"]=self["webpackChunkbylw"]||[]).push([[878],{6878:function(e,t,s){s.r(t),s.d(t,{default:function(){return g}});var a=function(){var e=this,t=e._self._c;return t("div",{staticClass:"suggestion"},[t("h2",[e._v("住户建议留言表")]),t("el-card",{staticClass:"input"},[t("el-input",{attrs:{type:"textarea",rows:2,placeholder:"请输入内容"},model:{value:e.suggestion,callback:function(t){e.suggestion=t},expression:"suggestion"}}),t("el-button",{staticClass:"send",attrs:{type:"primary"},on:{click:e.sendSuggestion}},[e._v("发送留言")])],1),t("div",{staticStyle:{"margin-bottom":"10px"}},[t("el-radio-group",{model:{value:e.reverse,callback:function(t){e.reverse=t},expression:"reverse"}},[t("el-radio",{attrs:{label:!0}},[e._v("倒序")]),t("el-radio",{attrs:{label:!1}},[e._v("正序")])],1)],1),t("el-timeline",{directives:[{name:"infinite-scroll",rawName:"v-infinite-scroll",value:e.load,expression:"load"}],attrs:{"infinite-scroll-disabled":"disabled","infinite-scroll-distance":"10","infinite-scroll-delay":"1000",reverse:e.reverse}},[e._l(e.msgData,(function(s){return t("el-timeline-item",{key:s.id,attrs:{timestamp:s.time,placement:"top"}},[t("el-card",{attrs:{"body-style":"display: flex; position: relative;"}},[t("img",{staticStyle:{width:"50px","border-radius":"25px","margin-right":"25px"},attrs:{src:s.avatar}}),t("div",[t("h4",{staticStyle:{"margin-bottom":"10px"}},[e._v(e._s(s.username))]),t("p",[e._v(e._s(s.suggestion))])]),t("el-popconfirm",{staticStyle:{"margin-left":"5px",position:"absolute",right:"20px",top:"15px"},attrs:{"confirm-button-text":"确认","cancel-button-text":"再想想",icon:"el-icon-info","icon-color":"red",title:"您确定删除吗？"},on:{confirm:function(t){return e.handleDelete(s.id)}}},[s.username==e.user.username||"admin"==e.user.username?t("el-button",{attrs:{slot:"reference",type:"danger",size:"small"},slot:"reference"},[e._v("删除留言")]):e._e()],1)],1)],1)})),e.loading?t("p",{staticClass:"loading",staticStyle:{"margin-top":"10px"}},[t("span")]):e._e(),e.noMore?t("p",{staticStyle:{"margin-top":"10px","font-size":"13px",color:"#ccc"}},[e._v("没有更多了...")]):e._e()],2),t("el-backtop",{attrs:{target:".suggestion"}},[t("i",{staticClass:"el-icon-caret-top"})])],1)},i=[],o=(s(541),{name:"Suggestion",data(){return{msgData:[],pageNum:0,pageSize:5,total:0,loading:!1,user:JSON.parse(sessionStorage.getItem("user"))||"",suggestion:"",reverse:!1}},created(){this.load()},computed:{noMore(){return this.msgData.length>=this.total},disabled(){return this.loading||this.noMore}},methods:{load(){this.loading=!0,this.pageNum+=1,console.log(this.pageNum),this.request.get("/api/suggestion/page",{params:{pageNum:this.pageNum,pageSize:this.pageSize}}).then((e=>{"200"===e.code&&(this.msgData=this.msgData.concat(e.data.records),this.total=e.data.total,this.loading=!1)}))},handleDelete(e){this.request.delete("/api/suggestion/"+e).then((e=>{console.log(e),"200"===e.code?(this.$message.success("删除成功"),location.reload()):this.$message.error("删除失败")}))},sendSuggestion(){const e=this.tool.getNowDate();this.request.post("/api/suggestion",{username:this.user.username,avatar:this.user.avatar,time:e,suggestion:this.suggestion}).then((e=>{"200"===e.code?(this.$message.success("新增成功"),this.request.get("/api/suggestion/new").then((e=>{console.log(e),"200"===e.code&&(this.msgData.unshift(e.data),this.total+=1)})),this.suggestion=""):this.$message.error("新增失败")}))}}}),n=o,r=s(1001),l=(0,r.Z)(n,a,i,!1,null,"2ece12e5",null),g=l.exports}}]);
//# sourceMappingURL=878.f46ff48d.js.map